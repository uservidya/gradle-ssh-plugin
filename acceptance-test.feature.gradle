apply plugin: 'ssh'

ssh {
    config(StrictHostKeyChecking: 'no')
}

remotes {
    localhost {
        role 'testServers'
        host = 'localhost'
        user = System.properties['user.name']
        identity = file("${System.properties['user.home']}/.ssh/id_rsa")
    }
}

feature('executing a command') {
    def temporaryName = "${buildDir}/${UUID.randomUUID()}"
    given {
        assert !file(temporaryName).exists()
    }

    task executeCommand(type: SshTask) {
        session(remotes.localhost) {
            execute "touch '${file(temporaryName).path}'"
        }
    }

    then {
        assert file(temporaryName).exists()
        assert file(temporaryName).delete()
    }
}
