apply plugin: 'ssh'

ssh {
    config(StrictHostKeyChecking: 'no')
}

remotes {
    localhost {
        role 'testServers'
        host = 'localhost'
        user = System.properties['user.name']
        identity = file("${System.properties['user.home']}/.ssh/id_rsa")
    }
}

feature('Execute a command') {
    def randomPathFile = file("${buildDir}/${UUID.randomUUID()}")

    given {
        randomPathFile.delete()
    }

    whenTask(type: SshTask) {
        session(remotes.localhost) {
            execute "touch '${randomPathFile.path}'"
        }
    }

    then {
        assert randomPathFile.exists()
        randomPathFile.delete()
    }
}
